# Alpha Panda Environment Configuration Example
# Copy this file to .env and customize for your environment

# Application
APP_NAME=Alpha Panda
ENVIRONMENT=development
LOG_LEVEL=DEBUG
# Logging levels
# - LOGGING__LEVEL: Preferred for enhanced logging (structlog + multi-channel).
#   This maps to Settings.logging.level and controls both console and file channels when enhanced logging is enabled.
# - LOG_LEVEL: Fallback/basic logger level (legacy). Used only when enhanced logging is not available.
# Recommended: keep both set to the same value in development for clarity.
LOGGING__LEVEL=DEBUG
ACTIVE_BROKERS=paper,zerodha

# Database
DATABASE__POSTGRES_URL=postgresql+asyncpg://username:password@localhost:5432/alpha_panda
DATABASE__SCHEMA_MANAGEMENT=auto
DATABASE__VERIFY_MIGRATIONS=true

# Redpanda/Kafka
REDPANDA__BOOTSTRAP_SERVERS=localhost:9092
REDPANDA__CLIENT_ID=alpha-panda-client
REDPANDA__GROUP_ID_PREFIX=alpha-panda

# Redis
REDIS__URL=redis://localhost:6379/0

# Authentication
AUTH__SECRET_KEY=your-secret-key-change-in-production
AUTH__ALGORITHM=HS256
AUTH__ACCESS_TOKEN_EXPIRE_MINUTES=30

# API Security (CORS)
API__CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080", "http://127.0.0.1:3000"]
API__CORS_CREDENTIALS=true
API__CORS_METHODS=["GET", "POST", "PUT", "DELETE", "OPTIONS"]
API__CORS_HEADERS=["Authorization", "Content-Type", "X-Request-ID"]

## Trading Service Enablement (Transition)
# Preferred flags (per-service control). If unset, defaults are paper=true, zerodha=false.
TRADING__PAPER__ENABLED=true
TRADING__ZERODHA__ENABLED=false

# (Legacy flags removed from runtime gating; use the TRADING__* flags above.)

# Zerodha Credentials (auth/feed required regardless of trading flag)
ZERODHA__API_KEY=your_zerodha_api_key
ZERODHA__API_SECRET=your_zerodha_api_secret
# Optional: if you already have a valid access token, set it to skip interactive auth
# ZERODHA__ACCESS_TOKEN=your_zerodha_access_token

# Paper Trading Configuration
PAPER_TRADING__SLIPPAGE_PERCENT=0.05
PAPER_TRADING__COMMISSION_PERCENT=0.1
PAPER_TRADING__LATENCY_MS_MEAN=0
PAPER_TRADING__LATENCY_MS_STD=0
PAPER_TRADING__PARTIAL_FILL_PROB=0.0
PAPER_TRADING__MAX_PARTIALS=3
PAPER_TRADING__STARTING_CASH=1000000.0
## Guardrails
# PAPER_TRADING__MIN_QUANTITY=1
# PAPER_TRADING__MAX_QUANTITY=10000
# PAPER_TRADING__MIN_PRICE=0.0
# PAPER_TRADING__MAX_PRICE=
# PAPER_TRADING__ALLOWED_INSTRUMENTS=[256265,260105]
# PAPER_TRADING__MAX_POSITION_NOTIONAL=500000.0

# Logging Configuration
LOGGING__JSON_FORMAT=true
LOGGING__CONSOLE_JSON_FORMAT=true
LOGGING__MULTI_CHANNEL_ENABLED=true
LOGGING__FILE_ENABLED=true
LOGGING__LOGS_DIR=logs
## Optional INFO log sampling (reduce high-frequency INFO noise)
# LOGGING__INFO_SAMPLING_RATIO=1.0

# Monitoring Configuration
MONITORING__HEALTH_CHECK_ENABLED=true
MONITORING__HEALTH_CHECK_INTERVAL=30.0
MONITORING__PIPELINE_FLOW_MONITORING_ENABLED=true
MONITORING__CONSUMER_LAG_THRESHOLD=1000
MONITORING__MARKET_DATA_LATENCY_THRESHOLD=1.0
## Optional Prometheus bucket tuning (override defaults)
# MONITORING__PROMETHEUS_BUCKETS__PROCESSING_LATENCY_SECONDS=[0.001,0.005,0.01,0.025,0.05,0.1,0.25,0.5,1.0,2.5,5.0,10.0]
# MONITORING__PROMETHEUS_BUCKETS__MARKET_ENQUEUE_DELAY_SECONDS=[0.0001,0.0005,0.001,0.005,0.01,0.025,0.05,0.1,0.25,0.5]
# MONITORING__PROMETHEUS_BUCKETS__MARKET_EMIT_LATENCY_SECONDS=[0.0001,0.0005,0.001,0.005,0.01,0.025,0.05,0.1,0.25,0.5,1.0]

# Tracing (OpenTelemetry)
# Enable to export traces from producers/consumers and key services
TRACING__ENABLED=false
TRACING__EXPORTER=none        # none|otlp
TRACING__OTLP_ENDPOINT=http://localhost:4317
TRACING__SAMPLING_RATIO=1.0

# Optional: Kafka producer tuning (JSON). Configure per-service tuning without code changes.
# Example: Slightly lower linger and zstd compression for market_feed
# PRODUCER_TUNING={"market_feed": {"linger_ms": 2, "compression_type": "zstd"}}

# Market Feed Runtime (Performance)
# MARKET_FEED__QUEUE_MAXSIZE=10000
# MARKET_FEED__ENQUEUE_BLOCK_TIMEOUT_MS=0     # 0 or unset = drop immediately when full; >0 = block up to N ms then drop
# MARKET_FEED__SUBSCRIPTION_BATCH_SIZE=0      # 0 or unset = subscribe all at once; >0 = batch size for subscribe/set_mode

# Development Notes:
# - For development: Use Zerodha authentication as primary
# - For production: Set AUTH__ENABLE_USER_AUTH=true and AUTH__PRIMARY_AUTH_PROVIDER=user
# - Change AUTH__SECRET_KEY to a secure random string in production
# - Use strong passwords for database in production
# - Consider using environment-specific values for LOG_LEVEL
# - Set ACTIVE_BROKERS=zerodha for zerodha-only trading or ACTIVE_BROKERS=paper,zerodha for both
# - Monitoring thresholds can be adjusted based on your trading requirements
